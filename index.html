<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Happy Birthday, Mathew!</title>

  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    canvas {
      display: block;
      touch-action: none;
    }
  </style>
</head>
<body>

<canvas id="game"></canvas>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const ballImage = new Image();
  ballImage.src = "Ball.png";


  // --------------------
  // Responsive sizing
  // --------------------
  let paddleWidth, paddleHeight, paddleY;
  let cpuPaddleWidth, cpuPaddleHeight, cpuPaddleY;
  let ballRadius;

  function resizeCanvas() {
    canvas.width = window.innerWidth * 0.95;
    canvas.height = window.innerHeight * 0.9;

    // Scale game elements proportionally
    paddleWidth = canvas.width * 0.28;
    paddleHeight = canvas.height * 0.018;
    paddleY = canvas.height - canvas.height * 0.07;

    cpuPaddleWidth = paddleWidth;
    cpuPaddleHeight = paddleHeight;
    cpuPaddleY = canvas.height * 0.04;

    ballRadius = canvas.width * 0.018;

    // Re-center paddles
    let paddleX = (canvas.width - paddleWidth) / 2;
    let cpuPaddleX = (canvas.width - cpuPaddleWidth) / 2;
  }

  resizeCanvas();
  window.addEventListener("resize", resizeCanvas);

  // --------------------
  // Game state
  // --------------------
  const WIN_SCORE = 9;
  let gameState = "start"; // start | playing | win | lose

  let playerScore = 0;
  let cpuScore = 0;

  // --------------------
  // Paddles
  // --------------------
  let paddleX = 0;
  let cpuPaddleX = 0;
  const cpuSpeed = 0.04;

  // --------------------
  // Ball
  // --------------------
  let ballX = 0;
  let ballY = 0;
  let ballVX = 0;
  let ballVY = 0;

  let ballSpeed = 4;
  const speedIncrease = 0.25;
  const maxBounceAngle = Math.PI / 3;

  function resetBallForServe() {
    ballX = canvas.width / 2;
    ballY = canvas.height / 2;
    ballSpeed = canvas.width * 0.01;

    const angle = (Math.random() * 2 - 1) * maxBounceAngle;
    ballVX = ballSpeed * Math.sin(angle);
    ballVY = Math.random() > 0.5 ? ballSpeed : -ballSpeed;
  }

  // --------------------
  // Input
  // --------------------
  function updatePaddle(x) {
    paddleX = x - paddleWidth / 2;
    if (paddleX < 0) paddleX = 0;
    if (paddleX + paddleWidth > canvas.width) {
      paddleX = canvas.width - paddleWidth;
    }
  }

  canvas.addEventListener("mousemove", e => {
    const rect = canvas.getBoundingClientRect();
    updatePaddle(e.clientX - rect.left);
  });

  canvas.addEventListener("touchmove", e => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    updatePaddle(e.touches[0].clientX - rect.left);
  }, { passive: false });

  canvas.addEventListener("click", startGame);
  canvas.addEventListener("touchstart", e => {
    e.preventDefault();
    startGame();
  }, { passive: false });

  function startGame() {
    if (gameState === "playing") return;

    if (gameState === "win" || gameState === "lose") {
      playerScore = 0;
      cpuScore = 0;
    }

    gameState = "playing";
    resetBallForServe();
  }

  // --------------------
  // Game loop
  // --------------------
  function update() {
    if (gameState !== "playing") return;

    ballX += ballVX;
    ballY += ballVY;

    // Side walls
    if (ballX - ballRadius < 0 || ballX + ballRadius > canvas.width) {
      ballVX *= -1;
    }

    // CPU movement
    const cpuCenter = cpuPaddleX + cpuPaddleWidth / 2;
    cpuPaddleX += (ballX - cpuCenter) * cpuSpeed;
    cpuPaddleX = Math.max(0, Math.min(canvas.width - cpuPaddleWidth, cpuPaddleX));

    // Player paddle collision
    if (
      ballY + ballRadius > paddleY &&
      ballX > paddleX &&
      ballX < paddleX + paddleWidth &&
      ballVY > 0
    ) {
      const offset = (ballX - (paddleX + paddleWidth / 2)) / (paddleWidth / 2);
      const angle = offset * maxBounceAngle;

      ballSpeed += speedIncrease;
      ballVX = ballSpeed * Math.sin(angle);
      ballVY = -ballSpeed * Math.cos(angle);
      ballY = paddleY - ballRadius;
    }

    // CPU paddle collision
    if (
      ballY - ballRadius < cpuPaddleY + cpuPaddleHeight &&
      ballX > cpuPaddleX &&
      ballX < cpuPaddleX + cpuPaddleWidth &&
      ballVY < 0
    ) {
      const offset = (ballX - (cpuPaddleX + cpuPaddleWidth / 2)) / (cpuPaddleWidth / 2);
      const angle = offset * maxBounceAngle;

      ballSpeed += speedIncrease;
      ballVX = ballSpeed * Math.sin(angle);
      ballVY = ballSpeed * Math.cos(angle);
      ballY = cpuPaddleY + cpuPaddleHeight + ballRadius;
    }

    // Scoring
    if (ballY + ballRadius < 0) {
      playerScore++;
      gameState = playerScore >= WIN_SCORE ? "win" : "start";
    }

    if (ballY - ballRadius > canvas.height) {
      cpuScore++;
      gameState = cpuScore >= WIN_SCORE ? "lose" : "start";
    }
  }

  function drawOverlay(title, subtitle = "") {
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "white";
    ctx.textAlign = "center";
    ctx.font = "36px sans-serif";
    ctx.fillText(title, canvas.width / 2, canvas.height / 2);

    if (subtitle) {
      ctx.font = "18px sans-serif";
      ctx.fillText(subtitle, canvas.width / 2, canvas.height / 2 + 30);
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Scores
    ctx.fillStyle = "white";
    ctx.font = "20px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText(cpuScore, canvas.width / 2, 30);
    ctx.fillText(playerScore, canvas.width / 2, canvas.height - 20);

    // Paddles
    ctx.fillRect(paddleX, paddleY, paddleWidth, paddleHeight);
    ctx.fillRect(cpuPaddleX, cpuPaddleY, cpuPaddleWidth, cpuPaddleHeight);

    // Ball
    if (ballImage.complete) {
    const size = ballRadius * 2;
        ctx.drawImage(
            ballImage,
            ballX - size / 2,
            ballY - size / 2,
            size,
            size
        );
    }

    if (gameState === "start") drawOverlay("Tap to Start", "Winner is the to 9 points (Best of 17)");
    if (gameState === "win") drawOverlay("ðŸŽ‰ You Win!", "Happy 17th Birthday, Mathew!");
    if (gameState === "lose") drawOverlay("ðŸ˜ž Game Over", "No presents for Mathew...");
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  loop();
</script>

</body>
</html>
